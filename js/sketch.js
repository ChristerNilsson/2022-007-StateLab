// Generated by CoffeeScript 2.5.1
// TODO
// Försämring av frameRate inträffar om man går från fullscreen till normal på Android

// Istället för sekunder är nu normalformen tertier, 60-dels sekunder
var lastStorageSave, rates, sumRate;

import {
  globals,
  createState
} from './globals.js';

import {
  CBits
} from './cbits.js';

import {
  CSettings
} from './settings.js';

import {
  SClock,
  SBasic,
  SAdv,
  S960
} from './states.js';

globals.bits = {};

globals.bits.minutes = new CBits([1, 2, 4, 8, 15, 30, 60]);

globals.bits.seconds = new CBits([1, 2, 4, 8, 15, 30, 60]);

globals.bits.handicap = new CBits([1, 2, 4, 8, 15, 30]);

globals.bits.number960 = new CBits([1, 2, 4, 8, 15, 30, 60, 120, 240, 480]);

globals.chess = {};

lastStorageSave = new Date();

rates = [];

sumRate = 0;

//############### p5 ###################
window.preload = function() {
  var i, len, ltr, ref, results;
  globals.qr = loadImage('qr.png');
  globals.sound = loadSound('key.mp3');
  ref = "KQRBN";
  results = [];
  for (i = 0, len = ref.length; i < len; i++) {
    ltr = ref[i];
    results.push(globals.chess[ltr] = loadImage(`chess\\${ltr}.png`));
  }
  return results;
};

window.windowResized = function() {
  return resizeCanvas(innerWidth, innerHeight);
};

window.setup = function() {
  var canvas;
  globals.settings = new CSettings(globals.bits);
  frameRate(globals.FRAMERATE);
  globals.os = navigator.appVersion;
  if (globals.os.indexOf('Linux') >= 0) {
    globals.os = 'Android';
  }
  if (globals.os.indexOf('Windows') >= 0) {
    globals.os = 'Windows';
  }
  if (globals.os.indexOf('Mac') >= 0) {
    globals.os = 'Mac';
  }
  canvas = createCanvas(innerWidth, innerHeight);
  bodyScrollLock.disableBodyScroll(canvas); // Förhindrar att man kan scrolla canvas på iOS
  if (globals.os === 'Android') {
    textFont('Droid Sans');
  }
  if (globals.os === 'Mac') {
    textFont('Verdana');
  }
  if (globals.os === 'Windows') {
    textFont('Lucida Sans Unicode');
  }
  globals.TOGGLE = globals.os === 'Mac' ? 1 : 0;
  background('black');
  textAlign(CENTER, CENTER);
  rectMode(CENTER);
  angleMode(DEGREES);
  createState('SClock', SClock);
  createState('SAdv', SAdv);
  createState('SBasic', SBasic);
  createState('S960', S960);
  globals.currState = globals.states.SClock;
  push();
  textSize(18 + 9);
  globals.tw = textWidth('0');
  return pop();
};

window.mousePressed = function() {
  if (globals.os === 'Windows') {
    return globals.currState.mouseClicked();
  }
};

window.touchStarted = function() {
  if (globals.os !== 'Windows') {
    return globals.currState.mouseClicked();
  }
};

window.draw = function() {
  var aspect;
  if (globals.TOGGLE === 0) {
    scale(width / 100, height / 100); // portrait
  } else {
    rotate(90);
    translate(0, -width);
    scale(height / 100, width / 100); // Landscape
  }
  strokeWeight(100 / height);
  push();
  background('black');
  globals.settings.tick();
  globals.currState.draw();
  pop();
  globals.settings.save();
  return aspect = function(w, h, y) {
    if (w < h) {
      [w, h] = [h, w];
    }
    return text(`${w} ${(w / h).toFixed(3)} ${h}`, 50, y);
  };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXHNrZXRjaC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUdvRTs7OztBQUFBLElBQUEsZUFBQSxFQUFBLEtBQUEsRUFBQTs7QUFFcEUsT0FBQTtFQUFRLE9BQVI7RUFBZ0IsV0FBaEI7Q0FBQSxNQUFBOztBQUNBLE9BQUE7RUFBUSxLQUFSO0NBQUEsTUFBQTs7QUFDQSxPQUFBO0VBQVEsU0FBUjtDQUFBLE1BQUE7O0FBQ0EsT0FBQTtFQUFRLE1BQVI7RUFBZSxNQUFmO0VBQXNCLElBQXRCO0VBQTJCLElBQTNCO0NBQUEsTUFBQTs7QUFFQSxPQUFPLENBQUMsSUFBUixHQUFlLENBQUE7O0FBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFiLEdBQXlCLElBQUksS0FBSixDQUFVLENBQUMsQ0FBRCxFQUFHLENBQUgsRUFBSyxDQUFMLEVBQU8sQ0FBUCxFQUFTLEVBQVQsRUFBWSxFQUFaLEVBQWUsRUFBZixDQUFWOztBQUN6QixPQUFPLENBQUMsSUFBSSxDQUFDLE9BQWIsR0FBeUIsSUFBSSxLQUFKLENBQVUsQ0FBQyxDQUFELEVBQUcsQ0FBSCxFQUFLLENBQUwsRUFBTyxDQUFQLEVBQVMsRUFBVCxFQUFZLEVBQVosRUFBZSxFQUFmLENBQVY7O0FBQ3pCLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBYixHQUF5QixJQUFJLEtBQUosQ0FBVSxDQUFDLENBQUQsRUFBRyxDQUFILEVBQUssQ0FBTCxFQUFPLENBQVAsRUFBUyxFQUFULEVBQVksRUFBWixDQUFWOztBQUN6QixPQUFPLENBQUMsSUFBSSxDQUFDLFNBQWIsR0FBeUIsSUFBSSxLQUFKLENBQVUsQ0FBQyxDQUFELEVBQUcsQ0FBSCxFQUFLLENBQUwsRUFBTyxDQUFQLEVBQVMsRUFBVCxFQUFZLEVBQVosRUFBZSxFQUFmLEVBQWtCLEdBQWxCLEVBQXNCLEdBQXRCLEVBQTBCLEdBQTFCLENBQVY7O0FBRXpCLE9BQU8s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b3VyY2VzQ29udGVudCI6WyIjIFRPRE9cclxuIyBGw7Zyc8OkbXJpbmcgYXYgZnJhbWVSYXRlIGludHLDpGZmYXIgb20gbWFuIGfDpXIgZnLDpW4gZnVsbHNjcmVlbiB0aWxsIG5vcm1hbCBww6UgQW5kcm9pZFxyXG5cclxuIyBJc3TDpGxsZXQgZsO2ciBzZWt1bmRlciDDpHIgbnUgbm9ybWFsZm9ybWVuIHRlcnRpZXIsIDYwLWRlbHMgc2VrdW5kZXJcclxuXHJcbmltcG9ydCB7Z2xvYmFscyxjcmVhdGVTdGF0ZX0gZnJvbSAnLi9nbG9iYWxzLmpzJ1xyXG5pbXBvcnQge0NCaXRzfSBmcm9tICcuL2NiaXRzLmpzJ1xyXG5pbXBvcnQge0NTZXR0aW5nc30gZnJvbSAnLi9zZXR0aW5ncy5qcydcclxuaW1wb3J0IHtTQ2xvY2ssU0Jhc2ljLFNBZHYsUzk2MH0gZnJvbSAnLi9zdGF0ZXMuanMnXHJcblxyXG5nbG9iYWxzLmJpdHMgPSB7fVxyXG5nbG9iYWxzLmJpdHMubWludXRlcyAgID0gbmV3IENCaXRzIFsxLDIsNCw4LDE1LDMwLDYwXVxyXG5nbG9iYWxzLmJpdHMuc2Vjb25kcyAgID0gbmV3IENCaXRzIFsxLDIsNCw4LDE1LDMwLDYwXVxyXG5nbG9iYWxzLmJpdHMuaGFuZGljYXAgID0gbmV3IENCaXRzIFsxLDIsNCw4LDE1LDMwXVxyXG5nbG9iYWxzLmJpdHMubnVtYmVyOTYwID0gbmV3IENCaXRzIFsxLDIsNCw4LDE1LDMwLDYwLDEyMCwyNDAsNDgwXVxyXG5cclxuZ2xvYmFscy5jaGVzcyA9IHt9XHJcblxyXG5sYXN0U3RvcmFnZVNhdmUgPSBuZXcgRGF0ZSgpXHJcblxyXG5yYXRlcyA9IFtdXHJcbnN1bVJhdGUgPSAwXHJcblxyXG4jIyMjIyMjIyMjIyMjIyMjIHA1ICMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbndpbmRvdy5wcmVsb2FkID0gLT5cclxuXHRnbG9iYWxzLnFyID0gbG9hZEltYWdlICdxci5wbmcnXHJcblx0Z2xvYmFscy5zb3VuZCA9IGxvYWRTb3VuZCAna2V5Lm1wMydcclxuXHRmb3IgbHRyIGluIFwiS1FSQk5cIlxyXG5cdFx0Z2xvYmFscy5jaGVzc1tsdHJdID0gbG9hZEltYWdlIFwiY2hlc3NcXFxcI3tsdHJ9LnBuZ1wiXHJcblxyXG53aW5kb3cud2luZG93UmVzaXplZCA9IC0+IHJlc2l6ZUNhbnZhcyBpbm5lcldpZHRoLCBpbm5lckhlaWdodFxyXG5cclxud2luZG93LnNldHVwID0gLT5cclxuXHRnbG9iYWxzLnNldHRpbmdzID0gbmV3IENTZXR0aW5ncyBnbG9iYWxzLmJpdHNcclxuXHJcblx0ZnJhbWVSYXRlIGdsb2JhbHMuRlJBTUVSQVRFXHJcblx0Z2xvYmFscy5vcyA9IG5hdmlnYXRvci5hcHBWZXJzaW9uXHJcblx0aWYgZ2xvYmFscy5vcy5pbmRleE9mKCdMaW51eCcpID49IDAgdGhlbiBnbG9iYWxzLm9zID0gJ0FuZHJvaWQnXHJcblx0aWYgZ2xvYmFscy5vcy5pbmRleE9mKCdXaW5kb3dzJykgPj0gMCB0aGVuIGdsb2JhbHMub3MgPSAnV2luZG93cydcclxuXHRpZiBnbG9iYWxzLm9zLmluZGV4T2YoJ01hYycpID49IDAgdGhlbiBnbG9iYWxzLm9zID0gJ01hYydcclxuXHJcblx0Y2FudmFzID0gY3JlYXRlQ2FudmFzIGlubmVyV2lkdGgsaW5uZXJIZWlnaHRcclxuXHRib2R5U2Nyb2xsTG9jay5kaXNhYmxlQm9keVNjcm9sbCBjYW52YXMgIyBGw7ZyaGluZHJhciBhdHQgbWFuIGthbiBzY3JvbGxhIGNhbnZhcyBww6UgaU9TXHJcblxyXG5cdGlmIGdsb2JhbHMub3MgPT0gJ0FuZHJvaWQnIHRoZW4gdGV4dEZvbnQgJ0Ryb2lkIFNhbnMnXHJcblx0aWYgZ2xvYmFscy5vcyA9PSAnTWFjJyB0aGVuIHRleHRGb250ICdWZXJkYW5hJ1xyXG5cdGlmIGdsb2JhbHMub3MgPT0gJ1dpbmRvd3MnIHRoZW4gdGV4dEZvbnQgJ0x1Y2lkYSBTYW5zIFVuaWNvZGUnXHJcblxyXG5cdGdsb2JhbHMuVE9HR0xFID0gaWYgZ2xvYmFscy5vcyA9PSAnTWFjJyB0aGVuIDEgZWxzZSAwXHJcblxyXG5cdGJhY2tncm91bmQgJ2JsYWNrJ1xyXG5cdHRleHRBbGlnbiBDRU5URVIsQ0VOVEVSXHJcblx0cmVjdE1vZGUgQ0VOVEVSXHJcblx0YW5nbGVNb2RlIERFR1JFRVNcclxuXHJcblx0Y3JlYXRlU3RhdGUgJ1NDbG9jaycsIFNDbG9jayBcclxuXHRjcmVhdGVTdGF0ZSAnU0FkdicsICAgU0FkdlxyXG5cdGNyZWF0ZVN0YXRlICdTQmFzaWMnLCBTQmFzaWNcclxuXHRjcmVhdGVTdGF0ZSAnUzk2MCcsICAgUzk2MFxyXG5cdFxyXG5cdGdsb2JhbHMuY3VyclN0YXRlID0gZ2xvYmFscy5zdGF0ZXMuU0Nsb2NrXHJcblxyXG5cdHB1c2goKVxyXG5cdHRleHRTaXplIDE4KzlcclxuXHRnbG9iYWxzLnR3ID0gdGV4dFdpZHRoICcwJ1xyXG5cdHBvcCgpXHJcblxyXG53aW5kb3cubW91c2VQcmVzc2VkID0gLT4gaWYgZ2xvYmFscy5vcyA9PSAnV2luZG93cycgdGhlbiBnbG9iYWxzLmN1cnJTdGF0ZS5tb3VzZUNsaWNrZWQoKVxyXG53aW5kb3cudG91Y2hTdGFydGVkID0gLT4gaWYgZ2xvYmFscy5vcyAhPSAnV2luZG93cycgdGhlbiBnbG9iYWxzLmN1cnJTdGF0ZS5tb3VzZUNsaWNrZWQoKVxyXG5cclxud2luZG93LmRyYXcgPSAtPlxyXG5cclxuXHRpZiBnbG9iYWxzLlRPR0dMRSA9PSAwXHJcblx0XHRzY2FsZSB3aWR0aC8xMDAsaGVpZ2h0LzEwMCAjIHBvcnRyYWl0XHJcblx0ZWxzZVxyXG5cdFx0cm90YXRlIDkwXHJcblx0XHR0cmFuc2xhdGUgMCwtd2lkdGhcclxuXHRcdHNjYWxlIGhlaWdodC8xMDAsd2lkdGgvMTAwICMgTGFuZHNjYXBlXHJcblxyXG5cdHN0cm9rZVdlaWdodCAxMDAvaGVpZ2h0XHJcblx0cHVzaCgpXHJcblx0YmFja2dyb3VuZCAnYmxhY2snXHJcblx0Z2xvYmFscy5zZXR0aW5ncy50aWNrKClcclxuXHRnbG9iYWxzLmN1cnJTdGF0ZS5kcmF3KClcclxuXHRwb3AoKVxyXG5cclxuXHRnbG9iYWxzLnNldHRpbmdzLnNhdmUoKVxyXG5cclxuXHRhc3BlY3QgPSAodyxoLHkpIC0+XHJcblx0XHRpZiB3IDwgaCB0aGVuIFt3LGhdID0gW2gsd11cclxuXHRcdHRleHQgXCIje3d9ICN7KHcvaCkudG9GaXhlZCgzKX0gI3tofVwiLCA1MCx5XHJcbiJdfQ==
//# sourceURL=c:\github\2022-007-StateLab\coffee\sketch.coffee